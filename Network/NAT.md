NAT (Network Address Translation) — это механизм переписывания IP-адресов в сетевом трафике. Он используется, чтобы соединить частные (внутренние) сети с внешними или изменять маршруты пакетов по определённым правилам.

|                |                    |                                            |
| -------------- | ------------------ | ------------------------------------------ |
| **SNAT**       | Source IP          | Когда внутренний клиент выходит в интернет |
| **DNAT**       | Destination IP     | Когда внешний клиент обращается вовнутрь   |
| **MASQUERADE** | Особый случай SNAT | На динамическом интерфейсе с меняющимся IP |

Вся суть — в таблице NAT-сессий (state table). Когда роутер делает SNAT, он не просто меняет IP отправителя. Он ещё и запоминает соответствие между:
- внутренним IP и портом, с которого запрос пришел на роутер
- и внешним IP и портом, который он подставил, с которого запрос отправился в интернет.
Таким образом, когда ответ приходит на внешний IP и порт, роутер точно знает, кому именно во внутренней сети этот ответ предназначен.