Flink - это фрэймворк для распределенной обработки данных в потоковом режиме (*stream processing*) с очень низкой задержкой. Несмотря на то, что Flink ориентирован на потоки, он умеет обрабатывать и пакеты, трактуя их как конечные потоки. Для хранения состояния Flink использует *State Backend* (RocksDB).

Особенности:
- **event-at-a-time** — каждое событие обрабатывается немедленно.
- **stateful processing** — позволяет накапливать информацию между событиями.
- **Гарантии доставки** — at-most-once / at-least-once / exactly-once (by default).

Во Flink существуют следующие понятия и сущности:
- **JobManager** — координирует выполнение задач, отслеживает прогресс, обрабатывает отказоустойчивость.
- **TaskManager'ы** — исполняют задачи (аналог executors в Spark).
- **Checkpointing** — механизм автоматического сохранения состояния для отказоустойчивости (может быть как инкрементальный, так и snapshot-based).
- **Savepoints** — механизм ручного бэкапа состояний для миграций или перезапусков. 
- **Windowing and Watermarks** — система управления временем и окнами событий.

Flink поддерживает три типа времени:
- **Processing Time** - Время на машине, когда событие обрабатывается
- **Event Time** - Время, когда событие реально произошло
- **Ingestion Time** - Время, когда Flink получил событие

**Windowing** — это способ группировать бесконечные потоки событий во временные блоки для последующей обработки.
- **Tumbling Window** - Фиксированный размер, без перекрытия (например, каждые 5 минут)
- **Sliding Window** - Фиксированный размер + шаг сдвига (например, окно 10 мин, сдвиг 5 мин)
- **Session Window** - Открывается при активности, закрывается по таймауту
- **Global Window** - Окно без границ, используется с триггерами

**Watermark** — это способ сообщить Flink, что "больше не стоит ждать старых событий, произошедших до определённого времени" Они нужны потому, что в потоках данные могут приходить с задержкой или в неправильном порядке. Без watermarks Flink не может знать, когда пора закрывать окно и запускать агрегацию. Например, если watermark = `15:00`, это означает, что события с `eventTime < 15:00` считаются устаревшими, и окна, зависящие от этих событий, можно закрывать.

### Flink vs Kafka Streams vs Spark Structured Streaming

| Характеристика          | **Apache Flink**                            | **Kafka Streams**                            | **Spark Structured Streaming**     |
| ----------------------- | ------------------------------------------- | -------------------------------------------- | ---------------------------------- |
| **Модель обработки**    | Event-at-a-time (настоящее real-time)       | Event-at-a-time                              | Micro-batching (псевдореалтайм)    |
| **Скалируемость**       | Высокая (кластерная, на уровне Yarn/K8s)    | Ограниченная, как правило, внутри одного JVM | Высокая (через Spark Cluster)      |
| **Отказоустойчивость**  | Да, с checkpoint'ами и recovery             | Да (через Kafka log), но с нюансами          | Да, с checkpoint'ами               |
| **Обработка состояния** | Поддержка больших состояний (RocksDB)       | Ограниченное состояние в JVM                 | Есть, но менее гибкое, чем у Flink |
| **Latency**             | Миллисекунды                                | Миллисекунды                                 | Секунды (из-за micro-batch)        |
| **Интеграции**          | Kafka, JDBC, Cassandra, Elasticsearch и др. | Только Kafka                                 | Kafka, JDBC, Delta, Hadoop и др.   |
| **Управление временем** | Event Time + Watermarks                     | Только Event Time (простое)                  | Event Time + Watermarks            |
| **API**                 | Java, Scala, Python (PyFlink)               | Java, Scala                                  | Scala, Python, Java                |
| **Развёртывание**       | Отдельный кластер                           | Встраивается в приложение                    | Отдельный кластер (Spark Cluster)  |
